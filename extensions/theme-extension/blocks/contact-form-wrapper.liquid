<div class="contact-form-wrapper py-6" {{ block.shopify_attributes }}>
  {% form 'contact' %}
    {{ form.errors | default_errors }}

    <div className="first-name">
      <label htmlFor="first-name">First name</label>
      <input type="text" name="contact[first_name]" id="first-name">
    </div>

    <div className="last-name">
      <label htmlFor="last-name">Last name</label>
      <input type="text" name="contact[last_name]" id="last-name">
    </div>

    <div className="phone">
      <label htmlFor="phone">Phone</label>
      <input type="tel" name="contact[phone]" id="phone">
    </div>

    <div className="email">
      <label htmlFor="email">Email</label>
      <input type="email" name="contact[email]" id="email">
    </div>

    <div className="message">
      <label htmlFor="message">Message</label>
      <textarea name="contact[body]" id="message"></textarea>
    </div>

    <div className="submit">
      <input type="submit" value="Create">
    </div>
  {% endform %}
</div>

{% schema %}
{
  "name": "Multi-Input Contact Form",
  "target": "section",
  "settings": []
}
{% endschema %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('.contact-form-wrapper form');
    const resultDiv = document.createElement('div');
    resultDiv.style.marginTop = '1rem';
    form.appendChild(resultDiv);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const payload = {
        shop: '{{ shop.domain }}', // Shopify shop domain from Liquid
        name: document.getElementById('first-name').value,
        last_name: document.getElementById('last-name').value,
        phoneNumber: document.getElementById('phone').value,
        email: document.getElementById('email').value,
        body: document.getElementById('message').value,
      };

      try {
        const response = await fetch('https://86a866df8824.ngrok-free.app/api/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        const data = await response.json();

        if (response.ok) {
          resultDiv.style.color = 'green';
          resultDiv.textContent = 'Form submitted successfully!';
          form.reset();
        } else {
          resultDiv.style.color = 'red';
          resultDiv.textContent = 'Error: ' + data.error;
        }
      } catch (error) {
        console.error(error);
        resultDiv.style.color = 'red';
        resultDiv.textContent = 'Failed to submit form.';
      }
    });
  });
</script>
